<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>罰單系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <script>
        function executeScript() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/creation_violation_ticket.py', true);
            xhr.send();
            alert('Script executed successfully!');
        }
    </script>
</head>
<body class="gradient-bg min-h-screen">
    <!-- 在 body 標籤內靠近頂部添加 -->
<!-- 登入按鈕和用戶信息區域 -->
<div class="fixed top-4 right-4 z-50">
    <!-- 登入按鈕 -->
    <button id="loginBtn" class="login-btn group">
        <div class="btn-content">
            <i class="fas fa-sign-in-alt mr-2 transform group-hover:rotate-12 transition-transform duration-300"></i>
            <span class="relative">
                登入
                <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-full"></span>
            </span>
        </div>
        <div class="btn-background"></div>
    </button>

    <!-- 用戶信息區塊 -->
    <div id="userInfo" class="hidden bg-white rounded-xl p-3 shadow-lg transform transition-all duration-300 hover:shadow-xl">
        <div class="flex items-center gap-3">
            <!-- 用戶頭像 -->
            <div class="user-avatar">
                <i class="fas fa-user text-gray-600"></i>
            </div>
            
            <!-- 用戶信息 -->
            <div class="flex flex-col">
                <span class="user-name font-medium text-gray-800"></span>
                <span class="text-sm text-gray-500">警員</span>
            </div>

            <!-- 登出按鈕 -->
            <button id="logoutBtn" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </div>
</div>

<!-- 登入模態框 -->
<div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 w-96 transform transition-all duration-300 scale-95 opacity-0" id="modalContent">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">登入系統</h2>
            <button id="closeLoginModal" class="modal-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form id="loginForm" class="space-y-6">
            <div class="form-group">
                <label class="form-label">帳號</label>
                <div class="input-wrapper">
                    <i class="fas fa-user text-gray-400"></i>
                    <input type="text" id="username" placeholder="請輸入帳號">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">密碼</label>
                <div class="input-wrapper">
                    <i class="fas fa-lock text-gray-400"></i>
                    <input type="password" id="password" placeholder="請輸入密碼">
                </div>
            </div>

            <button type="submit" class="submit-btn">
                <span>登入</span>
                <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </form>
    </div>
</div>
    <div class="hamburger-button">
        <div class="hamburger-lines">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
        </div>
    </div>
    
    <!-- 側邊選單 -->
    <div class="sidebar fixed top-0 left-0 h-full w-60 bg-white shadow-lg z-40">
        <div class="p-6">
            <h2 class="text-xl font-bold mb-8 text-gray-800 pl-2">罰單管理</h2>
            <nav>
                <ul class="space-y-4">
                    <li class="menu-item">
                        <a href="#" class="flex items-center p-3 text-gray-700 rounded-lg hover:bg-gray-100 transition-all duration-200">
                            <i class="fas fa-ticket-alt mr-3"></i>
                            所有罰單
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="flex items-center p-3 text-gray-700 rounded-lg hover:bg-gray-100 transition-all duration-200">
                            <i class="fas fa-clock mr-3"></i>
                            待處理
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="#" class="flex items-center p-3 text-gray-700 rounded-lg hover:bg-gray-100 transition-all duration-200">
                            <i class="fas fa-check-circle mr-3"></i>
                            已完成
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <div id="mainContent" class="transition-all duration-300">
        <div class="container mx-auto px-4 py-8">
            <!-- 標題區域 -->
            <div class="text-center mb-8 animate__animated animate__fadeInDown">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">罰單管理系統</h1>
            </div>

            <!-- 搜尋和功能區 -->
            <div class="bg-white rounded-lg p-6 mb-8 custom-shadow animate__animated animate__fadeInUp">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- 搜尋框 -->
                    <div class="relative">
                        <input type="text" 
                            placeholder="搜尋車牌號碼..."
                            class="search-input">
                        <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                    </div>
            
                    <!-- 日期選擇區 -->
                    <div class="flex gap-2 items-center">
                        <div class="relative flex-1">
                            <label class="text-sm text-gray-600 block mb-1">起始日期</label>
                            <input type="date" 
                                id="startDate"
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                        </div>
                        <div class="relative flex-1">
                            <label class="text-sm text-gray-600 block mb-1">結束日期</label>
                            <input type="date" 
                                id="endDate"
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                        </div>
                    </div>
            
                    <!-- 功能按鈕區域 -->
                    <div class="flex gap-2 md:col-span-2">
                        <button class="action-btn bg-black flex-1">
                            <i class="fas fa-print mr-2"></i> 批量列印
                        </button>
                        <button class="action-btn bg-black flex-1">
                            <i class="fas fa-file-export mr-2"></i> 匯出
                        </button>
                        <button id="startProcessing" class="bg-black text-white px-4 py-2 rounded flex-1">
                            開始處理
                        </button>
                        <button id="searchButton" 
                                class="bg-black text-white px-4 py-2 rounded transition-all duration-200 flex-1">
                            <i class="fas fa-search mr-2"></i>搜尋
                        </button>
                    </div>
                </div>
            </div>
        <!-- 在罰單列表上方添加批次操作按鈕 -->
            <div class="bg-white rounded-lg p-4 mb-6">
                <div class="flex justify-between items-center">
                    <div class="text-lg font-semibold">罰單列表</div>
                    <div class="flex gap-3">
                        <button id="selectAllBtn" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                            <i class="fas fa-check-square mr-2"></i>全選
                        </button>
                        <button id="cancelSelectBtn" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors hidden">
                            <i class="fas fa-times mr-2"></i>取消選擇
                        </button>
                    </div>
                </div>
            </div>

        <!-- 罰單列表 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for image in images %}
            <div class="ticket-card" data-ticket-id="{{ image.split('.')[0] }}" data-status="pending">
                <!-- 選取指示器 -->
                <div class="selection-indicator absolute top-3 left-3 z-10 opacity-0 transition-all duration-200">
                    <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-check text-white text-sm"></i>
                    </div>
                </div>
            
                <!-- 隱藏的 checkbox 用於保持原有功能 -->
                <input type="checkbox" 
                       class="ticket-selector hidden"
                       aria-hidden="true">
        
                <!-- 蓋章標記 -->
                <div class="stamp-mark hidden absolute top-3 right-3 z-10 bg-red-500 text-white p-1 rounded-full">
                    <i class="fas fa-stamp"></i>
                </div>
        
                <img src="{{ url_for('static', filename='images/' + image) }}" 
                     alt="{{ image }}"
                     class="w-full h-48 object-cover">
                <div class="p-4">
                    <h3 class="text-lg font-semibold mb-2">罰單編號: {{ image.split('.')[0] }}</h3>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600 print-time" data-ticket="{{ image }}">開立時間: </span>
                        <div class="button-group">
                            <button onclick="stampTicket('{{ image }}')" 
                                    class="card-btn bg-blue-500">
                                <i class="fas fa-stamp"></i>
                            </button>
                            <button class="card-btn bg-gray-500 preview-btn">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="card-btn bg-red-500">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div id="batchPanel" class="fixed bottom-0 left-0 w-full transform translate-y-full transition-transform duration-300 ease-in-out z-50">
            <div class="bg-white border-t shadow-lg p-4">
                <div class="container mx-auto flex justify-between items-center">
                    <span class="text-gray-700">
                        已選擇 <span id="selectedCount" class="font-bold">0</span> 張罰單
                    </span>
                    <div class="space-x-4">
                        <button id="batchStampBtn" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-stamp mr-2"></i>批次蓋章
                        </button>
                        <button id="moveToPrintBtn" 
                                class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-print mr-2"></i>移至待列印
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="stampPreviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
            <div class="bg-white rounded-lg w-3/4 max-w-4xl mx-auto mt-20 p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">蓋章預覽</h3>
                    <button id="closePreviewModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="previewGrid" class="grid grid-cols-3 gap-4 max-h-[60vh] overflow-y-auto">
                    <!-- 預覽內容將由 JavaScript 動態生成 -->
                </div>
                <div class="mt-6 flex justify-end space-x-4">
                    <button id="cancelStamp" 
                            class="px-6 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                        取消
                    </button>
                    <button id="confirmStamp" 
                            class="px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors">
                        確認蓋章
                    </button>
                </div>
            </div>
        </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    // 創建modal元素
    const modal = document.createElement('div');
    modal.id = 'imageModal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-80 z-50 hidden items-center justify-center p-4';
    modal.innerHTML = `
        <div class="relative max-w-4xl max-h-[90vh] w-full h-full">
            <img id="modalImage" class="w-full h-full object-contain opacity-0 transition-all duration-700 ease-in-out" src="" alt="Enlarged Image">
            <button id="closeModal" class="absolute top-4 right-4 text-white bg-black hover:bg-gray-800 p-2 rounded-full w-10 h-10 flex items-center justify-center transition-all duration-500 ease-in-out transform hover:rotate-45 hover:scale-110 shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
    `;
    document.body.appendChild(modal);

    // 獲取所有ticket-card的圖片
    const ticketImages = document.querySelectorAll('.ticket-card img');
    const modalImage = document.getElementById('modalImage');
    const imageModal = document.getElementById('imageModal');
    const closeModalBtn = document.getElementById('closeModal');

    // 為每個圖片添加點擊事件
    ticketImages.forEach(img => {
        img.classList.add('cursor-pointer', 'transition-transform', 'duration-300');
        img.addEventListener('click', () => {
            // 設置放大的圖片src
            modalImage.src = img.src;
            // 顯示modal
            imageModal.classList.remove('hidden');
            imageModal.classList.add('flex');
            
            // 稍微延遲添加opacity，創造淡入效果
            setTimeout(() => {
                modalImage.classList.remove('opacity-0');
                modalImage.classList.add('opacity-100');
            }, 50);
        });
    });

    // 關閉modal的事件監聽
    closeModalBtn.addEventListener('click', () => {
        // 先使圖片淡出
        modalImage.classList.remove('opacity-100');
        modalImage.classList.add('opacity-0');
        
        // 延遲隱藏modal，等待淡出動畫完成
        setTimeout(() => {
            imageModal.classList.remove('flex');
            imageModal.classList.add('hidden');
        }, 200);
    });

    // 點擊modal背景也可以關閉
    imageModal.addEventListener('click', (e) => {
        if (e.target === imageModal) {
            // 先使圖片淡出
            modalImage.classList.remove('opacity-100');
            modalImage.classList.add('opacity-0');
            
            // 延遲隱藏modal，等待淡出動畫完成
            setTimeout(() => {
                imageModal.classList.remove('flex');
                imageModal.classList.add('hidden');
            }, 300);
        }
    });
});
    </script>
</body>
</html>